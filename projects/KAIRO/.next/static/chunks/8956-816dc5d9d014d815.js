"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8956],{5380:(e,t,r)=>{r.d(t,{As:()=>i,OJ:()=>l});var a=r(5155),o=r(2115),s=r(5125),c=r(2663);let n=(0,o.createContext)(void 0);s.A.defaults.baseURL="".concat("http://localhost:3001","/api"),s.A.interceptors.request.use(e=>{let t=localStorage.getItem("token");return t&&(e.headers.Authorization="Bearer ".concat(t)),e},e=>Promise.reject(e)),s.A.interceptors.response.use(e=>e,async e=>{var t;let r=e.config;if((null==(t=e.response)?void 0:t.status)===401&&!r._retry){r._retry=!0;try{let e=localStorage.getItem("refreshToken");if(e){let{token:t}=(await s.A.post("/auth/refresh",{refreshToken:e})).data.data;return localStorage.setItem("token",t),r.headers.Authorization="Bearer ".concat(t),(0,s.A)(r)}}catch(e){localStorage.removeItem("token"),localStorage.removeItem("refreshToken"),window.location.href="/login"}}return Promise.reject(e)});let l=e=>{let{children:t}=e,[r,l]=(0,o.useState)(null),[i,u]=(0,o.useState)(!0);(0,o.useEffect)(()=>{(async()=>{if(localStorage.getItem("token"))try{let e=await s.A.get("/auth/me");l(e.data.data.user)}catch(e){localStorage.removeItem("token"),localStorage.removeItem("refreshToken")}u(!1)})()},[]);let d=async(e,t)=>{try{let{user:r,accessToken:a,refreshToken:o}=(await s.A.post("/auth/login",{email:e,password:t})).data.data;localStorage.setItem("token",a),localStorage.setItem("refreshToken",o),l(r),c.oR.success("Login successful!")}catch(t){var r,a;let e=(null==(a=t.response)||null==(r=a.data)?void 0:r.message)||"Login failed";throw c.oR.error(e),t}},h=async e=>{try{let{user:t,accessToken:r,refreshToken:a}=(await s.A.post("/auth/register",e)).data.data;localStorage.setItem("token",r),localStorage.setItem("refreshToken",a),l(t),c.oR.success("Registration successful!")}catch(a){var t,r;let e=(null==(r=a.response)||null==(t=r.data)?void 0:t.message)||"Registration failed";throw c.oR.error(e),a}},m=()=>{localStorage.removeItem("token"),localStorage.removeItem("refreshToken"),l(null),c.oR.success("Logged out successfully")},f=async e=>{try{let t=await s.A.put("/auth/profile",e);l(t.data.data.user),c.oR.success("Profile updated successfully!")}catch(a){var t,r;let e=(null==(r=a.response)||null==(t=r.data)?void 0:t.message)||"Profile update failed";throw c.oR.error(e),a}},g=async()=>{try{let e=localStorage.getItem("refreshToken");if(!e)throw Error("No refresh token");let{token:t}=(await s.A.post("/auth/refresh",{refreshToken:e})).data.data;localStorage.setItem("token",t)}catch(e){throw m(),e}};return(0,a.jsx)(n.Provider,{value:{user:r,loading:i,login:d,register:h,logout:m,updateProfile:f,refreshToken:g},children:t})},i=()=>{let e=(0,o.useContext)(n);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},6892:(e,t,r)=>{r.d(t,{A:()=>n});var a=r(5155),o=r(2115),s=r(6059),c=r(5748);function n(e){let{selectedAccount:t,onAccountSelect:r,className:n="",placeholder:l="Select a broker account"}=e,[i,u]=(0,o.useState)([]),[d,h]=(0,o.useState)(!1),[m,f]=(0,o.useState)(!0),[g,x]=(0,o.useState)(null);(0,o.useEffect)(()=>{p()},[]);let p=async()=>{try{f(!0);let e=localStorage.getItem("token");if(!e)throw Error("No authentication token found");let t=await fetch("/api/brokers/accounts",{headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}});if(!t.ok)throw Error("Failed to fetch broker accounts");let r=await t.json();if(r.success)u(r.data||[]);else throw Error(r.message||"Failed to fetch accounts")}catch(e){console.error("Error fetching broker accounts:",e),x(e instanceof Error?e.message:"Failed to load accounts")}finally{f(!1)}},y=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"USD";return new Intl.NumberFormat("en-US",{style:"currency",currency:t}).format(e)},v=e=>({ALPACA:"Alpaca",INTERACTIVE_BROKERS:"Interactive Brokers",TD_AMERITRADE:"TD Ameritrade",SCHWAB:"Charles Schwab",FIDELITY:"Fidelity",E_TRADE:"E*TRADE"})[e]||e,b=e=>{r(e),h(!1)};return m?(0,a.jsx)("div",{className:"relative ".concat(n),children:(0,a.jsx)("div",{className:"w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-50 text-gray-500",children:"Loading accounts..."})}):g?(0,a.jsx)("div",{className:"relative ".concat(n),children:(0,a.jsx)("div",{className:"w-full px-3 py-2 border border-red-300 rounded-md bg-red-50 text-red-600",children:g})}):0===i.length?(0,a.jsx)("div",{className:"relative ".concat(n),children:(0,a.jsx)("div",{className:"w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-50 text-gray-500",children:"No broker accounts found. Please connect a broker first."})}):(0,a.jsxs)("div",{className:"relative ".concat(n),children:[(0,a.jsxs)("button",{type:"button",onClick:()=>h(!d),className:"relative w-full cursor-pointer rounded-md border border-gray-300 bg-white py-2 pl-3 pr-10 text-left shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 sm:text-sm",children:[(0,a.jsx)("span",{className:"block truncate",children:t?(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium",children:v(t.brokerConnection.brokerType)}),(0,a.jsx)("span",{className:"ml-2 text-gray-500",children:t.brokerConnection.accountName})]}),(0,a.jsx)("div",{className:"text-sm text-gray-600",children:y(t.portfolioValue,t.currency)})]}):(0,a.jsx)("span",{className:"text-gray-500",children:l})}),(0,a.jsx)("span",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center pr-2",children:(0,a.jsx)(s.A,{className:"h-5 w-5 text-gray-400","aria-hidden":"true"})})]}),d&&(0,a.jsxs)("div",{className:"absolute z-10 mt-1 max-h-60 w-full overflow-auto rounded-md bg-white py-1 text-base shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none sm:text-sm",children:[(0,a.jsx)("div",{className:"relative cursor-pointer select-none py-2 pl-3 pr-9 text-gray-900 hover:bg-blue-50",onClick:()=>b(null),children:(0,a.jsx)("span",{className:"block truncate text-gray-500",children:"Clear selection"})}),i.map(e=>{var r;return(0,a.jsxs)("div",{className:"relative cursor-pointer select-none py-2 pl-3 pr-9 text-gray-900 hover:bg-blue-50",onClick:()=>b(e),children:[(0,a.jsx)("div",{className:"flex items-center justify-between",children:(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("span",{className:"font-medium",children:v(e.brokerConnection.brokerType)}),(0,a.jsx)("span",{className:"ml-2 text-gray-500",children:e.brokerConnection.accountName}),(0,a.jsx)("span",{className:"ml-2 text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded",children:e.brokerConnection.environment})]}),(0,a.jsxs)("div",{className:"text-sm text-gray-600 mt-1",children:[(0,a.jsx)("span",{children:{CASH:"Cash Account",MARGIN:"Margin Account",RETIREMENT:"Retirement Account",CRYPTO:"Crypto Account"}[r=e.accountType]||r}),(0,a.jsx)("span",{className:"mx-2",children:"•"}),(0,a.jsxs)("span",{children:["Account: ",e.accountNumber]})]}),(0,a.jsxs)("div",{className:"text-sm text-gray-600",children:[(0,a.jsxs)("span",{children:["Portfolio: ",y(e.portfolioValue,e.currency)]}),(0,a.jsx)("span",{className:"mx-2",children:"•"}),(0,a.jsxs)("span",{children:["Cash: ",y(e.cashBalance,e.currency)]}),(0,a.jsx)("span",{className:"mx-2",children:"•"}),(0,a.jsxs)("span",{children:["Buying Power: ",y(e.buyingPower,e.currency)]})]})]})}),(null==t?void 0:t.id)===e.id&&(0,a.jsx)("span",{className:"absolute inset-y-0 right-0 flex items-center pr-4 text-blue-600",children:(0,a.jsx)(c.A,{className:"h-5 w-5","aria-hidden":"true"})})]},e.id)})]})]})}},6992:(e,t,r)=>{r.d(t,{u:()=>n,y:()=>c});var a=r(5155),o=r(2115);let s=(0,o.createContext)(void 0);function c(e){let{children:t}=e,[r,c]=(0,o.useState)(null),[n,l]=(0,o.useState)([]),[i,u]=(0,o.useState)(!0),[d,h]=(0,o.useState)(null),m=async()=>{try{u(!0),h(null);let e=localStorage.getItem("token");if(!e)throw Error("No authentication token found");let t=await fetch("/api/brokers/accounts",{headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}});if(!t.ok)throw Error("Failed to fetch broker accounts");let a=await t.json();if(a.success)l(a.data||[]),r&&(a.data.find(e=>e.id===r.id)||c(null)),!r&&a.data.length>0&&c(a.data[0]);else throw Error(a.message||"Failed to fetch accounts")}catch(e){console.error("Error fetching broker accounts:",e),h(e instanceof Error?e.message:"Failed to load accounts"),l([])}finally{u(!1)}},f=async()=>{await m()};return(0,o.useEffect)(()=>{m()},[m]),(0,o.useEffect)(()=>{r?localStorage.setItem("selectedBrokerAccount",JSON.stringify(r)):localStorage.removeItem("selectedBrokerAccount")},[r]),(0,o.useEffect)(()=>{let e=localStorage.getItem("selectedBrokerAccount");if(e)try{let t=JSON.parse(e);c(t)}catch(e){console.error("Error parsing saved broker account:",e),localStorage.removeItem("selectedBrokerAccount")}},[]),(0,a.jsx)(s.Provider,{value:{selectedAccount:r,setSelectedAccount:c,accounts:n,loading:i,error:d,refreshAccounts:f},children:t})}function n(){let e=(0,o.useContext)(s);if(void 0===e)throw Error("useBrokerAccount must be used within a BrokerAccountProvider");return e}}}]);